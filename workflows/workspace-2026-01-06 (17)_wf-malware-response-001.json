{
  "name": "CyberSentinel - Malware Detection & Response",
  "nodes": [
    {
      "parameters": {
        "operation": "scheduled",
        "triggerTimes": {
          "item": {
            "mode": "everyX",
            "everyX": 5,
            "unit": "minutes"
          }
        }
      },
      "id": "malware-scheduler",
      "name": "Schedule: Every 5 Minutes",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1,
      "position": [
        100,
        200
      ]
    },
    {
      "parameters": {
        "url": "https://api.crowdstrike.com/detects/entities/summaries/GET/v1",
        "authentication": "genericCredentialType",
        "genericAuthType": "crowdStrikeApi",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "ids",
              "value": "={{ [\"malware_detection_001\", \"malware_detection_002\"] }}"
            }
          ]
        },
        "options": {}
      },
      "id": "crowdstrike-fetch",
      "name": "Fetch CrowdStrike Alerts",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [
        300,
        200
      ]
    },
    {
      "parameters": {
        "url": "https://api.misp-project.org/rest/alerts",
        "authentication": "genericCredentialType",
        "genericAuthType": "mispApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "={{$node['misp-credentials'].json['api_key']}}"
            }
          ]
        },
        "options": {}
      },
      "id": "misp-fetch",
      "name": "Fetch MISP Threat Intel",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [
        300,
        350
      ]
    },
    {
      "parameters": {
        "url": "https://otx.alienvault.com/api/v1/indicators/export",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-OTX-API-KEY",
              "value": "={{$node['otx-credentials'].json['api_key']}}"
            }
          ]
        },
        "options": {}
      },
      "id": "otx-fetch",
      "name": "Fetch AlienVault OTX Pulses",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [
        300,
        500
      ]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json['name'].toLowerCase()}}",
              "operation": "contains",
              "value2": "brickstorm"
            }
          ]
        }
      },
      "id": "brickstorm-detect",
      "name": "Detect BRICKSTORM Indicators",
      "type": "n8n-nodes-base.filter",
      "typeVersion": 1,
      "position": [
        500,
        200
      ]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json['name'].toLowerCase()}}",
              "operation": "contains",
              "value2": "kimwolf"
            }
          ]
        }
      },
      "id": "kimwolf-detect",
      "name": "Detect Kimwolf Indicators",
      "type": "n8n-nodes-base.filter",
      "typeVersion": 1,
      "position": [
        500,
        350
      ]
    },
    {
      "parameters": {
        "operation": "create",
        "resource": "incident",
        "projectKey": "SEC",
        "issueTypeId": "10001",
        "fields": {
          "summary": "=ðŸš¨ MALWARE ALERT: {{$json.name}} Detected",
          "description": "={{'Malware detected: ' + $json.name + '\\n\\nDetails:\\n' + JSON.stringify($json, null, 2)}}",
          "priority": {
            "name": "Highest"
          }
        }
      },
      "id": "create-incident",
      "name": "Create Security Incident",
      "type": "n8n-nodes-base.jira",
      "typeVersion": 1,
      "position": [
        700,
        200
      ],
      "credentials": {
        "jiraApi": {
          "id": "jira-credential",
          "name": "JIRA API"
        }
      }
    },
    {
      "parameters": {
        "text": "=ðŸš¨ **MALWARE DETECTION ALERT** ðŸš¨\n\n**Malware:** {{$json.name}}\n**Severity:** {{$json.severity}}\n**Host:** {{$json.hostname}}\n**Status:** Investigation Required\n\n**Immediate Actions:**\n1. Isolate affected host\n2. Preserve forensic evidence\n3. Begin malware analysis\n\n[Incident Link]({{$node['create-incident'].json['self']}})"
      },
      "id": "slack-malware-alert",
      "name": "Send Critical Slack Alert",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 1,
      "position": [
        900,
        200
      ],
      "credentials": {
        "slackApi": {
          "id": "slack-credential",
          "name": "Slack API"
        }
      }
    },
    {
      "parameters": {
        "operation": "send",
        "resource": "email",
        "to": "soc@example.com",
        "subject": "ðŸš¨ CRITICAL: Malware Detected - {{$json.name}}",
        "body": "=**MALWARE DETECTION ALERT**\n\nMalware: {{$json.name}}\nSeverity: {{$json.severity}}\nHostname: {{$json.hostname}}\n\nImmediate isolation and investigation required."
      },
      "id": "email-soc-alert",
      "name": "Email SOC Alert",
      "type": "n8n-nodes-base.emailReadImap",
      "typeVersion": 1,
      "position": [
        900,
        350
      ],
      "credentials": {
        "smtp": {
          "id": "smtp-credential",
          "name": "SMTP"
        }
      }
    },
    {
      "parameters": {
        "url": "https://api.crowdstrike.com/devices/entities/devices/v1",
        "authentication": "genericCredentialType",
        "genericAuthType": "crowdStrikeApi",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "action_name",
              "value": "contain"
            },
            {
              "name": "ids",
              "value": "={{[$json['device_id']]}}"
            }
          ]
        },
        "options": {}
      },
      "id": "endpoint-contain",
      "name": "Contain Endpoint (CrowdStrike)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [
        700,
        500
      ]
    },
    {
      "parameters": {
        "url": "https://www.virustotal.com/api/v3/files/{{$json['sha256']}}",
        "method": "GET",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-apikey",
              "value": "={{$node['vt-credentials'].json['api_key']}}"
            }
          ]
        },
        "options": {}
      },
      "id": "vt-analysis",
      "name": "Analyze with VirusTotal",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [
        500,
        500
      ]
    },
    {
      "parameters": {
        "url": "https://api.crowdstrike.com/real_time_response/entities/volume/v1",
        "authentication": "genericCredentialType",
        "genericAuthType": "crowdStrikeApi",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "session_id",
              "value": "={{$json['session_id']}}"
            },
            {
              "name": "command_text",
              "value": "=\"run -id {{$json['sha256']}} -path /tmp/quarantine/\""
            }
          ]
        },
        "options": {}
      },
      "id": "isolate-malware",
      "name": "Quarantine Malware File",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [
        700,
        650
      ]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json['severity']}}",
              "operation": "equal",
              "value2": "critical"
            }
          ]
        }
      },
      "id": "severity-filter",
      "name": "Filter Critical Severity",
      "type": "n8n-nodes-base.filter",
      "typeVersion": 1,
      "position": [
        500,
        650
      ]
    }
  ],
  "connections": {
    "Schedule: Every 5 Minutes": {
      "main": [
        [
          {
            "node": "Fetch CrowdStrike Alerts",
            "type": "main",
            "index": 0
          },
          {
            "node": "Fetch MISP Threat Intel",
            "type": "main",
            "index": 0
          },
          {
            "node": "Fetch AlienVault OTX Pulses",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch CrowdStrike Alerts": {
      "main": [
        [
          {
            "node": "Detect BRICKSTORM Indicators",
            "type": "main",
            "index": 0
          },
          {
            "node": "Detect Kimwolf Indicators",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Detect BRICKSTORM Indicators": {
      "main": [
        [
          {
            "node": "Create Security Incident",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Detect Kimwolf Indicators": {
      "main": [
        [
          {
            "node": "Create Security Incident",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Security Incident": {
      "main": [
        [
          {
            "node": "Send Critical Slack Alert",
            "type": "main",
            "index": 0
          },
          {
            "node": "Email SOC Alert",
            "type": "main",
            "index": 0
          },
          {
            "node": "Contain Endpoint (CrowdStrike)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch MISP Threat Intel": {
      "main": [
        [
          {
            "node": "Analyze with VirusTotal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter Critical Severity": {
      "main": [
        [
          {
            "node": "Quarantine Malware File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "id": "wf-malware-response-001",
  "meta": {
    "instanceId": "cyber-sentinel-001",
    "trigger_id": "a1a6b29f-1834-4666-82d7-1163ce25f64c",
    "agent_id": "a401e896-d617-4e97-8bbf-29f47e133c21",
    "created_at": "2025-12-27T14:20:11.968570+00:00",
    "threat_coverage": [
      "BRICKSTORM Backdoor",
      "Kimwolf Botnet",
      "Phantom Stealer",
      "VolkLocker Ransomware",
      "All malware families"
    ],
    "automation_features": [
      "Real-time alert ingestion from EDR",
      "Threat intel feed correlation",
      "Automatic incident creation",
      "Endpoint containment",
      "VirusTotal analysis",
      "Multi-channel alerting"
    ],
    "response_actions": [
      "Create security incident",
      "Notify SOC team",
      "Contain infected endpoints",
      "Quarantine malware files",
      "Trigger forensic analysis"
    ]
  }
}